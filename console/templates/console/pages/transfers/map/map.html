<!doctype html>
<html>
<!--
  Map Page | Cannlytics Console
  Created: 8/11/2021
  Updated: 8/12/2021
-->
{% extends "../transfers.html" %}
{% load get_env %}
{% block title %}Map | Transfers | Cannlytics {% endblock title %}
{% comment %} {% block console_css %}
  <style>
    .open-in-new::after {
      content: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAQElEQVR42qXKwQkAIAxDUUdxtO6/RBQkQZvSi8I/pL4BoGw/XPkh4XigPmsUgh0626AjRsgxHTkUThsG2T/sIlzdTsp52kSS1wAAAABJRU5ErkJggg==);
      margin: 0 3px 0 5px;
    }
    .figure-caption a {
      color: inherit;
      border-bottom: 1px dashed #000;
      text-decoration: none;
    }
    .figure-caption a:hover {
      background-color: rgba(229,58,35,.2);
    }
    body.dark .gm-style-iw-c,
    body.dark .gm-style-iw-d {
      background-color: #343434;
    }
    body.dark .gm-style-iw-d a {
      color: #50fa7b;
    }
    body.dark .btn-light {
      color: #1a1a1a !important;
    }
    .gm-style .gm-style-iw-c  {
      padding: 0;
    }
  </style>
{% endblock %} {% endcomment %}
{% block unit %}
<main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-md-4">

  <!-- Options -->
  <div class="row">

    <!-- Description -->
    <div class="col-md-7 mb-3">

      <!-- Title -->
      <h3 class="fs-5 mt-3">Find a lab for transfers</h3>
      <p class="fs-6 text-secondary">
        <small>
          Locate a lab to test your cannabis, browse analyses, and
          engage with like-minded scientists around the world.
        </small>
      </p>

    </div><!-- End of description -->

    <!-- Options  -->
    <div class="d-flex align-items-center mb-3 me-2">

      <!-- State selection -->
      <label class="form-label form-label-sm me-2 mb-0">
        State
      </label>
      <div class="">
        <select
          id="state_input"
          name="state"
          class="form-select form-select-sm"
          aria-label="State"
        >
          <!-- TODO: Dynamically load all states that Cannlytics operates in. -->
          <option value="OK" selected >
            Oklahoma
          </option>
        </select>
      </div>

      <!-- Search -->
      <!-- TODO: Let people search by analysis and compare prices -->
      <div
        id="search"
        class="d-flex align-items-center flex-grow-1 nav-search-form ms-4"
      >
        <label class="form-label form-label-sm me-2 mb-0">
          Search
        </label>
        <input
          aria-label="Search"
          id="searchInput"
          class="nav-search-input form-control form-control-sm"
          placeholder="Search"
          list="searchOptions"
          name="org_id"
          oninput="cannlytics.transfers.onMapSearchInput()"
          type="text"
        >
        <datalist id="searchOptions"></datalist>
        <button
          id="searchButton"
          class="nav-search-button btn btn-default p-0"
          style="transform:translateX(-32px);width:0;"
        >
          <span data-feather="search"></span>
        </button>
      </div><!-- End of search -->

      <!-- Request transfer -->
      <button
        class="btn btn-sm bg-gradient-green text-white"
        data-bs-toggle="modal"
        data-bs-target="#transferDialog"
      >
        Transfer samples
      </button>


    </div>

  </div><!-- End of options -->

  <!-- Lab map -->
  <figure class="figure w-100">

    <!-- Map -->
    <div id="map" style="height:420px;width:100%;" class="figure-img img-fluid"></div>

    <!-- Caption -->
    <figcaption class="figure-caption" style="max-width:540px;">
      <h6 class="sans-serif fw-bold mt-3">
        How Cannlytics sources data
      </h6>
      Cannlytics retrieves data through listings on Google Search and
      Google Maps and from a company's official website. Users can
      <a href="/labs/">contribute factual information</a> about labs, such as
      analyses and prices. If you believe that any
      information is incorrect or should be removed, then please contact
      <a href="mailto:support@cannlytics.com">support@cannlytics.com</a>.
      For further information about how Cannlytics sources data, then please
      see the open source
      <a href="https://github.com/cannlytics/cannlytics-engine">Cannlytics engine</a>.
    </figcaption>

  </figure>

  <!-- TODO: Transfer samples form -->
  <!-- id="transferDialog" -->

</main>
{% endblock unit %}

<!-- JavaScript -->
{% block console_js %}
  <script src="https://unpkg.com/@googlemaps/markerclustererplus/dist/index.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/OverlappingMarkerSpiderfier/1.0.3/oms.min.js"></script>
  <script type="text/javascript">
    var script = document.createElement('script');
    var apiKey = "{{ 'GOOGLE_MAPS_API_KEY'|get_env }}"; // Passing API key from Django.
    script.src = `https://maps.googleapis.com/maps/api/js?key=${apiKey}&callback=initMap`;
    script.defer = true;
    window.initMap = function() {
      cannlytics.transfers.initializeMap();
    }
    document.head.appendChild(script);
  </script>
{% endblock console_js %}
</html>
