<!doctype html>
<html>
<!--
  Publish Data Page | Cannlytics Website
  Copyright (c) 2021-2022 Cannlytics

  Authors: Keegan Skeate <https://github.com/keeganskeate>
  Created: 10/15/2021
  Updated: 6/26/2022
  License: MIT License <https://github.com/cannlytics/cannlytics/blob/main/LICENSE>
-->
{% extends "website/index.html" %}
{% load static icon %}
{% block title %}Publish Data | Cannlytics{% endblock %}
{% block material %}
<section class="container mb-2 mt-5">

  <!-- Breadcrumbs -->
  <div class="d-flex mt-4">
    <nav
      style="--bs-breadcrumb-divider: '>';"
      aria-label="breadcrumb"
    >
      <ol class="breadcrumb bg-transparent p-0 mb-0">
        <li class="breadcrumb-item fs-6 lh-sm">
          <a
            class="text-dark serif action"
            href="{% url 'page' page='data' %}"
          >
            Data
          </a>
        </li>
        <li class="breadcrumb-item fs-6 lh-sm">
          <a
            class="text-dark serif action"
            href="{% url 'section' page='data' section='market' %}"
          >
            Market
          </a>
        </li>
        <li class="breadcrumb-item active fs-6 lh-sm text-dark serif" aria-current="page">
          Publish Data
        </li>
      </ol>
      <div>
    </div>
    </nav>
  </div>

<!-- Publish a Dataset -->
<section class="container mb-5 markdown">

  <!-- Introduction -->
  {% comment %} {{ algorithm_market|safe }} {% endcomment %}

  <!-- Warning -->
  <div class="alert alert-warning d-flex justify-content-between mt-3 mb-4" role="alert">
    <div class="row d-flex align-items-center">
      <div class="col-1 me-3" style="max-width:42px;">{% icon 'alert-triangle' height="32" width="32"%}</div>
      <div class="col-10 ps-0"><small class="serif">
        The Cannabis Data Market is still in test-mode. You are welcome to test out the functionality,
        but <b class="serif">do not</b> use actual money and <b class="serif">do not</b> expect actual results.
        You can get <a href="https://www.rinkeby.io/#faucet" target="_blank" class="serif">test currency</a> to
        begin to explore the market.
        </small>
      </div>
    </div>
  </div>

  <!-- Publish an Dataset -->
  <div class="card mt-4">
    <div class="card-header">
      <h4 class="text-dark serif my-0">
        Publish a Dataset
      </h4>
    </div>
    <div class="card-body bg-transparent text-dark">

      <!-- Instructions-->
      <p class="mt-0 lh-md mb-lg-4" style="max-width:460px;">
        <small>
          Publish a data NFT that represents your asset.
          You control access to your
          data NFT and its pricing with a newly minted datatoken. You can also specify
          metadata for your data NFT.
          <button
            type="button"
            class="btn btn-tooltip-help p-0 mb-1 ms-1 text-start"
            style="border-color:transparent !important;"
            data-bs-toggle="tooltip"
            data-bs-html="true"
            title='Please refer to the <a href="https://github.com/cannlytics/cannlytics">documentation</a> to review the source code and get all of the information on how the market operates.'
          >
            {% icon 'help-circle' width="18px" height="18px" class="text-dark" %}
          </button>
        </small>
        </p>


      <div class="row">

        <!-- First Column -->
        <div class="col col-md-6">

          <!-- Algorithm Detail Form -->
          <form id="user-form">

            <!-- Dataset Title -->
            <div class="mt-3">
              <label
                for="input-dataset_title"
                class="form-label form-label-sm"
              >
                <small class="serif">Dataset Title</small>
              </label>
              <input
                id="input-dataset_title"
                class="form-control form-control-sm serif"
                name="dataset_title"
                spellcheck="false"
                type="text"
              >
            </div>

            <!-- Data File -->
            <!-- TODO: Allow users to have Cannlytics warehouse
              their datafiles in accordance with our terms of service.
            -->
            <div class="mt-3">
              <label
                for="input-dataset_file"
                class="form-label form-label-sm"
              >
                <small class="serif">Dataset File</small>
                <!-- TODO: Add info tip -->
              </label>
              <input
                id="input-dataset_file"
                class="form-control form-control-sm serif"
                name="dataset_file"
                type="text"
                spellcheck="false"
              >
            </div>

            <!-- Sample File -->
            <div class="mt-3">
              <label
                for="input-sample_file"
                class="form-label form-label-sm"
              >
                <small class="serif">Sample File</small>
              </label>
              <input
                id="input-sample_file"
                class="form-control form-control-sm serif"
                name="sample_file"
                type="text"
                spellcheck="false"
              >
            </div>

            <!-- Data Guide -->
            <div class="mt-3">
              <label
                for="input-data_guide"
                class="form-label form-label-sm"
              >
                <small class="serif">Data Guide</small>
              </label>
              <input
                id="input-data_guide"
                class="form-control form-control-sm serif"
                name="data_guide"
                type="text"
                spellcheck="false"
              >
            </div>

            <!-- Price -->
            <div class="mt-3">
              <label
                for="input-algorithm_price"
                class="form-label form-label-sm"
              >
                <small class="serif">Price per Download</small>
              </label>
              <div class="row d-flex justify-content-start">
                <div class="col-4 pe-1">
                  <input
                    id="input-algorithm_price"
                    class="form-control form-control-sm serif text-end"
                    style="max-width:140px;"
                    name="algorithm_price"
                    spellcheck="false"
                    type="number"
                    value="0.00"
                  >
                </div>
                <div class="col-4 ps-1">
                  <select
                    id="input-currency"
                    class="form-select form-select-sm serif col col-4"
                    style="max-width:140px;"
                    aria-label="Currency"
                    name="currency"
                  >
                    <option selected>USD ($)</option>
                  </select>
                </div>
              </div>
            </div>

            <!-- Description -->
            <!-- Optional: Allow user to upload a markdown file. -->
            <div class="mt-3">
              <label
                for="input-programming_language"
                class="form-label form-label-sm"
              >
                <small class="serif">Description</small>
              </label>
              <br>
              <textarea
                id="input-description"
                class="form-control form-control-sm serif"
                placeholder="You can write a description of your dataset to save as metadata. Remember, there is a cost for adding additional metadata."
                style="height: 150px"
                name="description"
              ></textarea>
            </div>

            <!-- License -->
            <div class="mt-3">
              <label
                for="input-license"
                class="form-label form-label-sm"
              >
                <small class="serif">License</small>
              </label>
              <select
                id="input-label"
                class="form-select form-select-sm serif"
                aria-label="Algorithm license."
                name="license"
              >
                <option selected>CC0: PublicDomain</option>
                <!-- Future work: Add other license types? E.g. CC BY 4.0 -->
              </select>
            </div>
          
            <!-- Keywords -->
            <div class="mt-3">
              <label
                for="input-keywords"
                class="form-label form-label-sm"
              >
                <small class="serif">Keywords</small>
              </label>
              <div class="row">
                <div class="col-10">
                  <input
                    type="text"
                    class="form-control form-control-sm serif"
                    id="input-keywords"
                    spellcheck="false"
                    name="keywords"
                  >
                </div>
                <button
                  class="btn btn-sm-light btn-md-light col-2"
                  type="button"
                  title="Add a keywords."
                  onclick="addKeyword();"
                >
                  {% icon "plus" width="16px" height="16px" %}
                </button>
              </div>
            </div>
            <div id="keyword-container" class="d-flex flex-wrap"></div>
            <div id="keyword-template" class="d-none">
              <span class="keyword-text badge background-hover bg-transparent border border-dark d-flex align-items-center text-dark me-1 mt-2 py-0 pe-0"></span>
            </div>
            <button id="keyword-remove-template" class="d-none btn btn-sm nav-link ms-1">
              {% icon "x" width="16px" height="16px"%}
            </button>
            <input type="text" id="keywords" class="visually-hidden" name="keywords">

          </form><!-- End of Algorithm Detail Form  -->

        </div><!-- End of First Column -->

        <!-- Second Column | Python Code Editor -->
        <div class="col col-md-6">
          <div class="row mt-3">
            <label
              for="input-image_url"
              class="col col-form-label col-form-label-sm mb-0 serif"
            >
              Dataset Image
            </label>
            <div class="col d-flex justify-content-end">
              <button
                class="btn btn-sm btn-sm-light serif"
                onclick="uploadDatasetImage()"
              >
                Upload Image
              </button>
            </div>
          </div>
          <!-- Image -->
          <!-- FIXME: Allow the user to select an  image for the dataset. -->
          <!-- Add an infotip with the recommended size of an image. -->
          <div class="text-center">
            <img
              class="pt-3 pe-3"
              style="max-width:100%; max-height:350px;"
              src="{% static "website/images/emojies/bar-chart.svg" %}"
            >
            <input type="file" id="dataset_image" multiple accept="image/*" class="visually-hidden" name="dataset_image">
          </div>
        </div><!-- End of Second Column -->

        <!-- Publish -->
        <!-- TODO: Show "Preview" before "Publish" button -->
        <!-- TODO: Add checkbox for "I agree to the terms of service" / "View the terms of service" -->
        <div class="d-flex align-items-end mt-4">
          <button
            class="btn btn-sm bg-gradient-purple text-white serif"
            onclick="publishDataset();"
          >
            Publish Dataset
          </button>
        </div>

        <!-- Notice and Disclaimer -->
        <div class="mt-5">
          <h6 class="fw-bold mb-1 mt-3 serif">Notice</h6>
          <p class="fs-6 lh-md mt-0">
            <small class="serif">
              The Cannlytics Team maintains a purgatory list
              to block the listing of any dataset that
              violates any policy.
            </small>
          </p>
          <h6 class="fw-bold mb-1 mt-3 serif">Disclaimer</h6>
          <p class="fs-6 lh-md mt-0">
            <small class="serif" style="font-size:0.7rem;">
            THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
            IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
            FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
            AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
            LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
            OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
            SOFTWARE.
            </small>
          </p>
        </div>
        

      </div>
    </div>
  </div><!-- End of Publish an Algorithm -->

  <!-- About -->
  <!-- FIXME: Re-write -->
  {% comment %} <div class="my-5">
    <h2 class="mb-2 text-dark serif">Need more information?</h2>
    <p class="fs-6 mt-0" style="max-width:540px;">
      The <a href="{% url "page" page="team" %}">
        Cannabis Data Science Team
      </a> and smart, talented people
      all around the world are chomping at the bits to write
      useful algorithms for you! Do you have any shortcomings at
      all with your current software system? Then these talented
      individuals can plug all of the holes in your current software
      with robust, peer-reviewed software at pennies
      on the dollar of the price of your traditional, closed-source developer.
      Please, take full advantage of the beautiful technology
      of open-source, smart contracts.
    </p>
    <div class="mt-3">
      <a
        class="btn btn-sm bg-gradient-orange text-white serif"
        href="{% url "page" page="contact" %}?topic=algorithms"
      >
        Get help now &rarr;
      </a>
    </div>
  </div> {% endcomment %}

  {% comment %} <p class="fs-6 double-line mb-3 mt-3" style="max-width:540px;">
  If you are eager to sell your data, then please contact
  <a class="serif text-gradient" href="mailto:sales@cannlytics.com">sales@cannlytics.com</a>
  and we will work with you to manually list your data for the time being.
</p> {% endcomment %}

</section>
{% include "website/components/art/vines.html" %}
{% endblock material %}
{% block page_css %}
  <style>
    .tooltip-inner {
      text-align: left;
    }
  </style>
{% endblock page_css %}
{% block page_js %}
  <script>
    
    // Initialize tooltips.
    cannlytics.ui.enableTooltips();

    function addKeyword() {
      /**
       * Add a keyword.
       */
      var input = document.getElementById('input-keywords');
      var value = input.value;
      var keywordsInput = document.getElementById('keywords');
      var keywords = keywordsInput.value.split(',');
      if (keywords.includes(value)) return;
      var docFrag = document.createDocumentFragment();
      var tempNode = document.getElementById('keyword-template').cloneNode(true);
      var tempButton = document.getElementById('keyword-remove-template').cloneNode(true);
      tempButton.classList.remove('d-none');
      tempButton.id = `keyowrd-remove-${value}`;
      tempButton.onclick = function() {
        removeKeyword(value);
      }
      tempNode.id = `keyowrd-${value}`;
      tempNode.classList.remove('d-none');
      tempNode.querySelector('.keyword-text').innerText = value;
      tempNode.querySelector('.keyword-text').appendChild(tempButton);
      docFrag.appendChild(tempNode);
      document.getElementById('keyword-container').appendChild(docFrag);
      keywords.push(value);
      keywordsInput.value = keywords.join(',');
      input.value = '';
    }

    function removeKeyword(value) {
      /**
       * Remove a keyword.
       */
      document.getElementById(`keyowrd-${value}`).remove();
      var keywordsInput = document.getElementById('keywords');
      var keywords = keywordsInput.value.split(',');
      keywords = keywords.filter(function(item) { return item !== value; });
      keywordsInput.value = keywords.join(',');
    }
    
    function publishDataset() {
      /**
       * Publish a data NFT, listing the dataset on the data market.
       */

      // Parse keywords.
      var keywordsInput = document.getElementById('keywords');
      var keywords = keywordsInput.value.split(',');
      keywords = keywords.filter(function(item) { return item !== ""; });

      // Optional: Either have the user specify or determine on upload:
      // - Number of fields
      // - Number of observations
      // - File size
      // - File type

      // TODO: Parse the rest of the form.

      // TODO: Post the dataset to the API to publish the dataset as a data NFT.

      // TODO: Redirect the user to the published data page.
      cannlytics.utils.showNotification('Under Development', 'At this time, publishing data NFTs is still under development. Please consider funding a small portion of our efforts or contributing on GitHub.', 'error', 7000);

    }
    
    function uploadDatasetImage() {
      /**
       * Upload an image for a dataset.
       */
      // TODO: Implement.
      cannlytics.utils.showNotification('Under Development', 'At this time, publishing data NFTs is still under development. Please consider funding a small portion of our efforts or contributing on GitHub.', 'error', 7000);
    }

  </script>
{% endblock page_js%}
</html>
