<!doctype html>
<html>
<!--
  Potential Effects and Aromas Prediction Model Page | Cannlytics Website
  Copyright (c) 2022 Cannlytics

  Authors: Keegan Skeate <contact@cannlytics.com>
  Created: 5/14/2022
  Updated: 6/3/2022
  License: MIT License <https://github.com/cannlytics/cannlytics-website/blob/main/LICENSE>

  TODO:

    - Let the user switch between models.

    - Let the user upload lab results.

    - Let the user search and load strains.

    - Display predictions with colors, icons, and model stats.

    - Let the user save / share the predictions.

    - If the user is signed in, let them post actual effects and aromas.

    - Let the user clear the form.

-->
{% extends "website/index.html" %}
{% load static icon %}
{% block title %}Effects and Aromas Stats | Cannlytics{% endblock %}
{% block material %}

<section class="container mb-2 mt-5">

  <!-- Title -->
  <div class="d-flex mt-4">
    <nav
      style="--bs-breadcrumb-divider: '>';"
      aria-label="breadcrumb"
    >
      <ol class="breadcrumb bg-transparent p-0 mb-0">
        <li class="breadcrumb-item fs-6 lh-sm">
          <a
            class="text-dark serif action"
            href="{% url 'page' page='stats' %}"
          >
            Statistics
          </a>
        </li>
        <li class="breadcrumb-item active fs-6 lh-sm text-dark serif" aria-current="page">
          Effects and Aromas
        </li>
      </ol>
      <div>
    </div>
    </nav>
  </div>


  <!-- Prediction Form -->
  <section class="markdown">
    <img
      alt="SkunkFx"
      src="https://firebasestorage.googleapis.com/v0/b/cannlytics.appspot.com/o/public%2Fimages%2Flogos%2Fskunkfx_logo.png?alt=media&token=1a75b3cc-3230-446c-be7d-5c06012c8e30"
      style="height:140px;"
    >
    <p class="mt-0 lh-md" style="max-width:560px;">
      <small><b class="serif">SkunkFx</b> is the official Cannlytics effects and aromas prediction model.
      The model is used to predict effects and aromas that
      may be reported for a given cannabis product given its lab results.
      </small>
    </p>

    <!-- Form options -->
    <div class="d-flex justify-content-between align-items-center w-100 mt-2">
    
      <!-- Model selection -->
      <div class="d-flex align-items-center">
        <label
          for="model-selection"
          class="col-sm-4 col-form-label"
        >
          <small class="serif">Model</small>
        </label>
        <select
          id="model-selection"
          class="app-action form-select form-select-sm btn-sm-light btn-md-light"
          aria-label="State select"
          style="width:150px;"
          onchange="cannlytics.stats.changeModel(this);"
        >
          <!-- FIXME: Add `selected` to current model or else `totals`. -->
          {% for key in variables.variables %}
            <option value="{{ key }}">{{ key|title_case }}</option>
          {% endfor %}
        </select>
      </div>

      <!-- TODO: Autocomplete to search for strains -->

      <!-- Upload lab results button -->
      <div class="ms-2">
        <button
          id="view-all-labs"
          class="btn btn-sm btn-sm-light btn-md-light"
          onclick="cannlytics.stats.uploadLabResults();"
        >
          {% icon 'upload-cloud' width="16px" class="me-1" %}
          <small class="serif">Upload Lab Results</small>
        </button>
      </div>

      <!-- TODO: Clear the form button -->

    </div>
    
    <form id="effects-form">

      <!-- Strain Name -->


      <!-- TODO: Product type with only flower enabled at the moment. -->

      <!-- Render the various models. -->
      {% for model, values in variables.variables.items %}
        <div id="{{ model }}-fields" class="d-flex flex-wrap d-none">
          {% comment %} <h3 class="mt-3 mb-0 w-100">{{ model|title_case }} Model</h3> {% endcomment %}

          <!-- Cannabinoids -->
          {% if model == 'full' or model == 'cannabinoid_only'%}
            <h6 class="serif w-100 mt-3">Cannabinoids</h6>
            {% for analyte in values %}
              {% if analyte.type == 'cannabinoid' %}
              <div class="col-sm-6">
              <div class="row mb-1">
                <label
                  for="input-{{ model }}-{{ analyte.key }}"
                  class="col col-form-label col-form-label-sm"
                  style="max-width:130px;"
                >
                  {{ analyte.name|greek_letters }}
                </label>
                <div class="col-sm-3">
                  <input
                    id="input-{{ model }}-{{ analyte.key }}"
                    class="form-control form-control-sm"
                    style="max-width:90px;"
                    name="{{ analyte.key }}"
                    spellcheck="false"
                    type="number"
                    autocomplete="off"
                    onchange="cannlytics.stats.changeField(this);"
                    min="0"
                    max="40"
                    value=""
                  >
                </div>
                <div class="col-sm-5">
                  <input
                    id="range-{{ model }}-{{ analyte.key }}"
                    class="form-range custom-range"
                    type="range"
                    min="0"
                    max="40"
                    value="0"
                    onchange="cannlytics.stats.changeField(this);"
                  >
                </div>
              </div>
              </div>
              {% endif %}
            {% endfor %}
          {% endif %}

          <!-- Terpenes -->
          {% if model == 'full' or model == 'terpene_only'%}
            <h6 class="serif w-100 mt-3">Terpenes</h6>
            {% for analyte in values %}
              {% if analyte.type == 'terpene' %}
              <div class="col-sm-6">
              <div class="row mb-1">
                <label
                  for="input-{{ model }}-{{ analyte.key }}"
                  class="col col-form-label col-form-label-sm"
                  style="max-width:130px;"
                >
                  {{ analyte.name|greek_letters }}
                </label>
                <div class="col-sm-3">
                  <input
                    id="input-{{ model }}-{{ analyte.key }}"
                    class="form-control form-control-sm"
                    style="max-width:90px;"
                    name="{{ analyte.key }}"
                    spellcheck="false"
                    type="number"
                    autocomplete="off"
                    onchange="cannlytics.stats.changeField(this);"
                    min="0"
                    max="40"
                    value=""
                  >
                </div>
                <div class="col-sm-5">
                  <input
                    id="range-{{ model }}-{{ analyte.key }}"
                    class="form-range custom-range"
                    type="range"
                    min="0"
                    max="40"
                    value="0"
                    onchange="cannlytics.stats.changeField(this);"
                  >
                </div>
              </div>
              </div>
              {% endif %}
            {% endfor %}
          {% endif %}

          <!-- TODO: Totals -->

    
        </div>
      {% endfor %}

      <!-- Predict! -->
      <div class="d-flex justify-content-center mt-4">
        <button
          id="view-all-labs"
          class="btn bg-gradient-purple text-white serif"
          onclick="cannlytics.stats.getPredictions();"
        >
          {% icon 'zap' width="16px" class="me-1" %}
          Predict
        </button>
      </div>

  
    </form>

    <!-- TODO: Render prediction -->

      <!-- Save and export results -->

      <!-- Clear the prediction -->

      <!-- Show predicted positive effects -->

      <!-- Show predictednegative effects -->

      <!-- Show predicted aromas -->

      <!-- Optional: Determine most similar strain? -->

      <!-- Optional: Show terpene ratios and predict "Indica" / "Sativa"
      and type 1, type 2, type 3, and type 4 cananbinoid profiles
      -->

      <!-- Feedback form to report actual effects and aromas -->


    <!-- Model information -->
    <p class="mt-0 lh-md mt-4" style="max-width:560px;">
      <small><b class="serif">Notes:</b>
      For technical details of the model, please see the
      <a href="https://github.com/cannlytics/cannlytics"><small>documentation</small></a>.
      Please remember that the predictions are simply statistics are
      should not be mistaken as claims.
      </small>
    </p>

  </section>


  <!-- About the API -->
  <section class="markdown">

  <h2 class="mt-5">API</h2>
  <p>
    Tell your developer(s) about our <a href="https://github.com/cannlytics/cannlytics">free effects and aromas API</a>! If you're paying for quality control tests and/or terpene tests, then you may
    as well have the effects and aromas of your products predicted.
    Simply input cannabinoid and/or terpene data and you will receive a
    surprisingly useful prediction of effects and aromas.
    The cherry üçí on top is that you can report back the actual
    effects and aromas that characterize your product and the
    model becomes that much smarter!
    So, you can make your predictions better over time
    if you opt-in to providing feedback.
    Please explore at your pleasure and, hopefully, you are able to find many clever uses for the statistics.
  </p>
  <!-- TODO: API query builder! -->

  <!-- Data Source Notice -->
  <h2 class="mt-5">Data Sources</h2>
  <ul>
    <li>
      <p class="fs-small">
        <b class="serif">Dataset</b>:	<a class="fw-normal" href="https://cannlytics.page.link/reported-effects">Curated Cannabis Strains, their Average Chemical Compositions, and Reported Effects and Aromas</a><br>
        <b class="serif">Author</b>:	Cannlytics<br>
        <b class="serif">Created</b>:	5/18/2022<br>
        <b class="serif">Updated</b>:	6/4/2022<br>
        <b class="serif">Original Authors</b>: <a class="fw-normal" href="https://data.mendeley.com/datasets/6zwcgrttkp/1" target="_blank">
          de la Fuente, et al. (2019)
        </a>.<br>
        <b class="serif">License</b>: <a class="fw-normal" href="https://creativecommons.org/licenses/by/4.0/" target="_blank">
          CC BY 4.0.
        </a>
      </p>
      <p class="mt-2">
        <small>The files associated with this dataset are licensed under a Creative Commons Attribution 4.0 International license.</small>
      </p>
      <p class="mt-2">
        <small>You can share, copy and modify this dataset so long as you give appropriate credit, provide a link to the CC BY license, and indicate if changes were made, but you may not do so in a way that suggests the rights holder has endorsed you or your use of the dataset. Note that further permission may be required for any content within the dataset that is identified as belonging to a third party.</small>
      </p>
    </li>
  </ul>

  <!-- Disclaimer -->
  <h2 class="mt-5">Disclaimer</h2>
  <p class="fs-6">
    <small class="simple-serif">
    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
    SOFTWARE.
    </small>
  </p>

</section>


</section>

<!-- Vines -->
{% include "website/components/art/vines.html" %}

{% endblock material %}

<!-- JavaScript -->
{% block page_js %}
  <script>

    // Show the current model on page load.
    const model = document.getElementById('model-selection').value;
    document.getElementById(`${model}-fields`).classList.remove('d-none');
    console.log('Model:', model);

    // TODO: Get strains and populate the search form.

  
    // DRAFT
    // Get variable definitions (aromas and effects) to use for rendering effect / aroma colors and icons.
    // cannlytics.stats.getDefinitions('public/data/variables/effects_and_aromas');
  
  </script>
{% endblock %}

</html>
